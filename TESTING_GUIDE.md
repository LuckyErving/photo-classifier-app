# 测试验证步骤

## 功能测试清单

### 1. 首次启动测试
- [ ] 启动应用，点击"拍照"按钮
- [ ] 检查是否正确请求相机和存储权限
- [ ] 授予权限后，是否能正常进入拍照界面
- [ ] 检查是否默认选择了"Default"文件夹

### 2. 文件夹选择测试
- [ ] 在拍照界面，文件夹下拉列表是否正常显示
- [ ] 切换不同文件夹，是否有Toast提示当前文件夹
- [ ] 拍照后，照片是否保存到选择的文件夹

### 3. 创建新文件夹测试
- [ ] 点击"+"按钮，是否弹出创建文件夹对话框
- [ ] 输入合法的文件夹名称（如"工作照片"），是否创建成功
- [ ] 创建后，下拉列表是否自动切换到新文件夹
- [ ] 输入空名称或包含"/"字符，是否正确提示错误
- [ ] 输入已存在的文件夹名称，是否提示"文件夹已存在"

### 4. 文件夹记忆功能测试
- [ ] 选择一个文件夹后拍照
- [ ] 完全关闭应用（从后台清除）
- [ ] 重新打开应用进入拍照界面
- [ ] 检查是否自动选择了上次使用的文件夹

### 5. 拍照保存测试
- [ ] 在不同文件夹下拍照
- [ ] 检查照片是否保存到正确的文件夹
- [ ] 照片命名格式是否为 `IMG_yyyyMMdd_HHmmss.jpg`

### 6. USB导出测试
- [ ] 使用USB数据线连接手机到电脑
- [ ] 在手机上选择"文件传输"模式
- [ ] 在电脑上找到路径：`内部存储/DCIM/PhotoClassifier/`
- [ ] 检查是否能看到所有创建的文件夹
- [ ] 打开文件夹，检查照片是否都在
- [ ] 尝试复制文件夹到电脑，是否成功

### 7. 多文件夹切换测试
- [ ] 创建多个文件夹（如"家庭"、"工作"、"旅行"）
- [ ] 在不同文件夹间切换拍照
- [ ] 检查每个文件夹下的照片是否正确

### 8. 边界情况测试
- [ ] 文件夹名称超长（如100个字符）
- [ ] 文件夹名称包含特殊字符（空格、中文、emoji）
- [ ] 存储空间不足时拍照
- [ ] 连续快速切换文件夹

## 预期结果

### 存储位置验证
照片应该存储在：
```
/storage/emulated/0/DCIM/PhotoClassifier/<文件夹名>/IMG_<时间戳>.jpg
```

### SharedPreferences验证
可以通过以下方式查看存储的偏好设置（需要开发者模式）：
```bash
adb shell
cat /data/data/com.example.photoclassifier/shared_prefs/PhotoClassifierPrefs.xml
```

应该能看到：
```xml
<?xml version='1.0' encoding='utf-8' standalone='yes' ?>
<map>
    <string name="last_selected_folder">/storage/emulated/0/DCIM/PhotoClassifier/工作照片</string>
</map>
```

## 不同Android版本测试

### Android 9 及以下
- 需要 `WRITE_EXTERNAL_STORAGE` 权限
- 应该能正常写入 DCIM 目录

### Android 10-12
- 使用 `requestLegacyExternalStorage="true"`
- 应该能正常写入 DCIM 目录

### Android 13+
- 需要 `READ_MEDIA_IMAGES` 权限
- 应该能正常写入 DCIM 目录

## 常见问题排查

### 问题1：无法保存照片
- 检查是否授予了存储权限
- 检查 DCIM 目录是否存在
- 检查存储空间是否充足

### 问题2：USB连接电脑看不到照片
- 确认手机选择了"文件传输"模式
- 确认路径是 `DCIM/PhotoClassifier/`
- 尝试拔插USB线

### 问题3：文件夹选择不保存
- 检查 SharedPreferences 是否正常写入
- 检查应用是否有读写数据权限

### 问题4：创建文件夹失败
- 检查文件夹名称是否合法
- 检查是否已存在同名文件夹
- 检查存储权限
